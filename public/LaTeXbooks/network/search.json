["ネットワーク tomixy since 2021/11/1 目次 第 I 部 ネットワークの形態（WAN と LAN） 1 1 範囲に応じたネットワーク 1 2 LAN の接続形態 1 3 LAN の規格 1 4 データを運ぶ通信路の方式 3 5 WAN 構築サービスの種類 4 6 ネットワーク処理の形態 4 第 II 部 ネットワーク通信の規約（TCP/IP） 5 7 プロトコルとモデル 6 8 OSI 参照モデルの世界標準実装 TCP/IP 8 9 パケット 9 10 ヘッダ 10 i ","目次 ii 11 ネットワーク層 10 11.1 MAC アドレス ................................... 10 11.2 IP アドレス .................................... 11 11.3 一斉送信 ...................................... 13 11.4 ネットワーク分割 ................................. 13 11.5 ルーティングとルータ .............................. 15 11.6 IP アドレスと MAC アドレスの変換 ...................... 16 11.7 IP というプロトコル ............................... 16 11.8 IP ヘッダ ...................................... 16 11.9 ネットワーク検査 ................................. 18 11.10パケットの分割送信 ................................ 19 11.11仮 .......................................... 19 12 トランスポート層 19 12.1 仮 .......................................... 20 12.1.1 グローバル IP アドレスとプライベート IP アドレスの変換 ..... 20 13 アプリケーション層 21 13.1 IP アドレスの別名 ................................ 21 13.2 ネットワークの設定 ................................ 21 13.3 ネットワークの管理 ................................ 22 13.4 代表的なサービス ................................. 23 13.5 サービスの識別 .................................. 24 13.6 電子メールの仕組み ................................ 26 13.7 電子メールの宛先 ................................. 27 13.8 電子メールで扱うデータ形式 .......................... 27 14 リンク層 27 14.1 仮 .......................................... 28 15 TCP/IP の進化 30 ","目次 iii 第 III 部 ネットワークの伝送速度 30 第 IV 部 データの誤り制御 30 ","1 第 I 部 ネットワークの形態（WAN と LAN） 1 範囲に応じたネットワーク LAN （ Local Area Network ）は、一つの施設内で用いられるネットワークであり、 ユーザ が主体となって運用・管理を行う。 WAN （ Wide Area Area Network ）は、遠く離れた LAN 同士を結ぶ広域ネットワーク であり、 電気通信事業者 が運用・管理に関わる必要がある。 2 LAN の接続形態 LAN を構築する際の各コンピュータの繋ぎ方にはさまざまな形態があり、その形態 を トポロジー と呼ぶ。 スター 型は、 ハブ を中心として、放射状に各コンピュータを接続する形態である。 バス 型は、1 本の基幹となる ケーブル に各コンピュータを接続する形態である。 リング 型は、リング状に各コンピュータを接続する形態である。 3 LAN の規格 LAN の規格として、現在最も普及しているのが イーサネット である。 IEEE （ 米国電気電子技術者協会 ）によって標準化されており、次のような規格に分か れている。 ","2 接続形態 規格名称 伝送速度 伝送距離 伝送媒体 バス型 10BASE5 10M bps 最大 500 m （ Thick coax ） 太さ 10 mm の 同軸ケーブル 10BASE2 10M bps 最大 185 m （ Thin coax ） 太さ 5 mm の 同軸ケーブル スター型 10BASE-T 10M bps 最大 100 m ツイストペアケーブル 100BASE-TX 100M bps 最大 100 m ツイストペアケーブル 1000BASE-T 1G bps 最大 100 m ツイストペアケーブル イーサネットは、アクセス制御方式として、 CSMA/CD （ Carrier Sense Multiple Access / Collision Detection ）方式を採用して いる。 この方式では、ネットワーク上の通信状況を監視して、他に送信を行っている者がいない 場合に限ってデータの送信を開始する。（ Carrier Sense ） それでも同時に送信してしまい、通信パケットの衝突（ コリジョン ）が発生した場合は、 各々乱数時間分待機してから再度送信を行う。（ Collision Detection ） このように通信を行うことで、1 本のケーブルを複数のコンピュータで共有すること （ Multiple Access ）を可能にしている。 リング型 LAN の代表格である トークンリング では、送信の権利を表す トークン という 小さなデータをネットワークに一方通行で流しておく トークンパッシング 方式をアクセ ス制御方式に採用している。 トークンパッシング方式では、次のように通信を行う。 1. 平常時は何もついていない フリートークン だけがネットワーク上を流れている 2. データを送信したい時は、トークンにデータをくっつけて次へ流す （トークンが ビジートークン に変化） 3. 自分宛てでないデータはそのまま次へ流し、 自分宛てのデータは受け取ってから、受信済マークをつけて再度ネットワーク上に 流す 4. マークが付加されたトークンが送信元に到着すると、 送信元はトークンを フリートークン に戻してからネットワークに放流し、平常時 ","3 の状態に戻る 送信の権利は、 フリートークン をもつ端末にしかない。 ケーブルを必要とせず、電波などを使って無線で通信を行う LAN を 無線 LAN といい、 IEEE802.11 シリーズとして規格化されている。 アクセスポイント からの電波が届く範囲であれば自由に移動することができるが、 電波を 盗聴 されてしまう恐れもあるため、通信を 暗号 化するなど、しっかりとしたセ キュリティ対策が必要になる。 4 データを運ぶ通信路の方式 コンピュータがデータをやりとりするためには、互いを結ぶ通信路が必要である。 最もシンプルな形は、互いを直接 1 本の回線で結んでしまう方式であり、 これを 専用回線方式 という。 しかし、これでは通信相手が固定されており、相手の切り替えが面倒であるため、 交換機 が回線の選択を行って、必要に応じた通信路が確立される 交換方式 が生まれた。 回線交換方式 では、送信元から送信先にまで至る経路を交換機がつなぎ、通信路として 固定する。 通信路に選ばれた回線は使用中のペアに占有されるため、他の端末がその回線を使うこと はできない。 パケット交換方式 では、 1. 送信データをバラバラに分割して パケット （小包）にする 2. 宛先情報をくっつけて回線に送り出す 3. 交換機は仕分け係として、宛先を確認して適切な回線に送信する という手順で通信路を確立する。 回線が使用中となるのは小包が送られる短時間の間だけであり、その間は次の小包を交換 機が蓄積しておいてくれるため、複数の端末で回線を共有して使うことができるが、その ","4 分 遅延 が発生することもある。 5 WAN 構築サービスの種類 専用線 は拠点間を専用回線で結ぶサービスであり、 回線速度 と 距離 によって費用が決 まる。 セキュリティは 高 いが、非常に 高 額。 フレームリレー方式 は、 パケット交換方式を元に、伝送中の 誤り制御 を簡略化して高速 化を図ったもの。 データ転送の単位は 可変 長の フレーム を用いる。 ATM 交換方式 （ セルリレー方式 ）は、パケット交換方式を元に、データ転送の単位 を 固定 長とすることで高速化を図り、 遅延 を小さくしたもの。 広域イーサネット は、LAN で一般的に使われている イーサネット 技術を用いて拠点間 を接続するもの。 高 速で、一般的に使用している機器をそのまま使えるため、コスト面のメリットが大き く、近年の WAN 構築の主流となっている。 6 ネットワーク処理の形態 集中処理 は、 ホスト コンピュータが集中的に処理をして、他のコンピュータはそれにぶ ら下がる構成の処理形態である。 長所は • データの 一貫 性を維持・管理しやすい • セキュリティ の確保や運用管理が簡単 短所は • システムの 拡張 が大変 ","5 • ホスト コンピュータが壊れると全体が止まってしまう 分散処理 は、複数のコンピュータに負荷を分散させて、それぞれで処理を行うようにし た構成の処理形態である。 長所は • システムの 拡張 が簡単 • 一部のコンピュータが壊れても全体に影響しない 短所は • データの 一貫 性を維持・管理しづらい • セキュリティ の確保や運用管理が大変 以前は大型のコンピュータが全ての処理を行う集中処理が主流だったが、小型コンピュー タの性能が上がってきたことにより、分散処理へと移りつつあった。 しかし、分散処理ではデータを一元管理できないという欠点を解消するため、 • 集中的に管理したほうが良い資源やサービスを提供する サーバ • 必要に応じてリクエストを投げる クライアント という 2 種類のコンピュータで処理を行う クライアントサーバシステム が生まれた。 サーバには、 • ファイルを共有して、保存したり渡したりする ファイルサーバ • プリンタを共有して、印刷させてあげたりする プリントサーバ • データベースへのリクエストを処理する データベースサーバ • Web ページを公開する Web サーバ • 電子メールを受け取ったり送ったり保管したりする メールサーバ などがある。 ","6 第 II 部 ネットワーク通信の規約（TCP/IP） 7 プロトコルとモデル 固定電話で電話をかけるときには、 1. 受話器を取る 2. 電話番号を入力 3. 挨拶する、名乗る 4. 会話する 5. 電話を切ることを相手に伝える 6. 受話器を置く などという手順を踏む。 何らかの機器を通してコミュニケーションをするときには、いくつかの手順を踏む必要が ある。 人は自らの頭で考えてその場で手順を差し替えたり省いたりすることができるが、コン ピュータはそうはいかない。 そのため、コンピュータ同士のやりとりでは、厳格な手順マニュアルが定められており、 これを 通信プロトコル という。 通信プロトコル は、当初はコンピュータのメーカごとに異なるものであったため、同じ メーカのコンピュータ同士でしかやりとりができないという制約があった。 どのコンピュータ同士でもやりとりできるようにするため、世界共通のプロトコルであ る OSI （ Open System Interconnection ） 参照モデル ）が定められた。 電話越しに話して相手に伝わるまでの過程は、 1. 脳（話すことを考える） 2. 声帯（声を出す） 3. 電話機（音声を電気信号に変換して相手先に送る） 4. 相手の耳（聞く） 5. 相手の脳（内容を理解する） ","7 という階層で表される。話したい内容というデータが、脳で定義され、声帯を通り、電話 機で変換され、相手の耳を通り、相手の脳に届く、というイメージである。その過程で データは声、電気信号、音などと、さまざまな形に変換されている。 同様に、OSI 参照モデルでのやりとりも、次のような階層で表すことができる。 1. 物理層 （物理的にどう繋ぐかを定義） 2. データリンク層 （同一ネットワーク内でどう通信するかを定義） 3. ネットワーク層 （ネットワーク間をどう中継するかを定義） 4. トランスポート層 （通信の信頼性はどう確保するかを定義） 5. セッション層 （通信の開始から終了までをどう管理するかを定義） 6. プレゼンテーション層 （データはどんな形式にするかを定義） 7. アプリケーション層 （具体的にどんなサービスを提供するかを定義） データがアプリケーション層で定義され、プレゼンテーション層を通り、セッション層を 通り、トランスポート層を通り、ネットワーク層を通り、データリンク層を通り、物理 層に届いて機械が理解できる形に変換される。 このように、7 層全てを組み合わせることによって、ようやくコンピュータ同士のコミュ ニケーションが成立する。 通信手順を階層に分けることで、それぞれの工程で使う機器や手法を取り替えやすくして いる。 アプリケーション層 （第 7 層）は、通信に使うアプリケーション（サービス）そのもの である。 プレゼンテーション層 （第 6 層）は、データの表現方法を変換する。 • 画像ファイルをテキスト形式に変換する • データを圧縮する など。 セッション層 （第 5 層）では、通信するプログラム間で会話を行う。 • セッションの開始や終了を管理する • 同期をとる ","8 など。 トランスポート層 （第 4 層）では、コンピュータ内でどの通信プログラム（サービス） と通信するのかを管理し、通信の 信頼 性を確保する。 ネットワーク層 （第 3 層）では、ネットワーク上でデータが 始点 から 終点 まで配送さ れるように管理する。 ルーティング を行い、データを転送する。 データリンク層 （第 2 層）では、ネットワーク上でデータが 隣の通信機器 まで配送さ れるように管理する。通信機器間で信号の受け渡しを行う。 物理層 （第 1 層）では、物理的な接続を管理する。電気信号の変換を行う。 8 OSI 参照モデルの世界標準実装 TCP/IP OSI 参照モデルは、各層の役割を定義しているだけで、実際の実装方法にはさまざまなも のがある。 その中で世界標準となったものが TCP/IP であり、 OSI 参照モデルを少し改変して、 4 階 層で構成されている。 OSI TCP/IP アプリケーション層 アプリケーション層 プレゼンテーション層 セッション層 トランスポート層 トランスポート層 ネットワーク層 ネットワーク層 データリンク層 リンク層 物理層 TCP/IP にはたくさんのプロトコルがあるが、その中核となるのが • TCP （ Transmission Control Protocol ） ","9 • IP （ Internet Protocol ） という二つのプロトコルである。 IP の役割は目的地まで荷物を運ぶことであるが、実際に目的地まで荷物が到着する保証 はない。 そのため、荷物が目的地までちゃんと届いたか管理するプロトコルとして TCP を用いる。 この二つを組み合わせることによって、荷物が目的地までちゃんと届く仕組みを実現でき ている。 TCP/IP のプロトコルは、 IETF （ Internet Engineering Task Force ）が主体となって 標準化（策定）を行い、 RFC （ Request for Comments ）という技術文書を発行するこ とで仕様を公開している。 議論にはエンジニアであれば誰でも参加でき、プロトコルは民主的な取り組みを通して決 められている。 TCP/IP などのインターネットの技術を、そのまま企業内 LAN などに転用したネットワー クのことを イントラネット という。 9 パケット このプロトコルを使うネットワークでは、通信データを パケット （ データグラム ）に分 割して通信路へ流すことで、大きなデータで通行止めを起こすことなくネットワークの帯 域を分け合うことを実現している。 tcpdump というコマンドは、コンピュータの中を流れる通信を覗き見できるコマンドで あり、 通信を覗き見する行為を パケットキャプチャ （ スニッフィング ）という。 同様の行為は、 Wireshark というソフトウェアでも行うことができる。 ","10 10 ヘッダ TCP/IP による通信では、上の層から受け取ったデータ（ ペイロード ）に、自分の層で使 う情報を ヘッダ として先頭にくっつけて、さらに下の層へと渡していく。 トランスポート 層では、ペイロードに TCP ヘッダを付加する。 この時の TCP ヘッダが付加されたパケットを TCP セグメント という。 ネットワーク 層では、ペイロードに IP ヘッダを付加する。 この時の IP ヘッダが付加されたパケットを IP データグラム という。 データリンク 層では、ペイロードにイーサネットヘッダを付加する。 この時のイーサネットヘッダが付加されたパケットをイーサネット フレーム という。 ヘッダの中で情報を記載する領域のことを フィールド という。 ヘッダの内容は箱型のダイアグラムで表現することができ、そのダイアグラムで示される 構造を、 プロトコルのフォーマット という。 11 ネットワーク層 11.1 MAC アドレス LAN はある端末から送信されたパケットを、接続されている全ての端末に送ろうとする。 （※物理的な LAN 構成によっては送れない。） 送信するパケットには宛先が記述されており、端末は自分宛でないとわかると、そのパ ケットを破棄する。 LAN では、宛先として MAC （ Media Access Control ） アドレス を使用している。 これはハードウェア自身につけられる一意の番号であり、メーカから出荷される段階で刻 ","11.2 IP アドレス 11 印されるもので、ユーザが変更することはできない。 MAC アドレスは、次のような構成になっている。 • 最初の 3 バイトはメーカごとに異なる ベンダーコード • 末尾の 3 バイトはメーカが各ハードウェアにつける一意の番号 MAC アドレスは、 米国電気電子技術者協会 （ IEEE ： Institute of Electrical and Electronic Engineers ） によって管理されている。 11.2 IP アドレス 世界中の組織で構成されている LAN 同士を接続したものを インターネット といい、 LAN の LAN とも呼ばれる。 世界中から必要のないパケットが無差別に届くと大変なことになるため、LAN のような 小規模ネットワークと同じ仕組みは使えない。 そこで、大まかな送信先を表す IP アドレス というものが導入され、これによりある程度 範囲を絞ってパケットを送信することが可能になった。 例えるならば、MAC アドレスがマイナンバーで、IP アドレスは住所である。 IP アドレスは 32 ビットの数値で表されるが、2 進数のままでは長すぎるので、 8 ビット ずつに区切って、各々を 10 進数で表し、それらを . で繋いで表記する。 IP アドレスは、住所と同じように階層化されており、 • ネットワークごとに異なる ネットワークアドレス部 （例：都道府県） • 一つのネットワーク内でコンピュータを識別するための ホストアドレス部 （例： 市区町村以降） ","11.2 IP アドレス 12 などと分かれている。 さらに IP アドレスは、使用するネットワークの規模によって次の 3 つのクラスに分かれ ている。 クラス ネットワーク 先頭ビット ネットワーク ホスト 割り当て可能な の規模 アドレス部 アドレス部 ホスト数 A 大 規模 0 8 ビット 24 ビット 2 24 − 2 = 16777214 台 B 中 規模 10 16 ビット 16 ビット 2 16 − 2 = 65534 台 C 小 規模 110 24 ビット 8 ビット 2 8 − 2 = 254 台 ホストアドレス部が • すべて 0 となるアドレスは ネットワークアドレス • すべて 1 となるアドレスは ブロードキャストアドレス として予約されているため、 割り当て可能なホスト数 = ホストアドレス部の桁数で表せる数 − 2 となっている。 グローバル IP アドレス は、インターネットの世界で使用する IP アドレスである。 世界中で一意であることが保証されなければならないため、 ICANN （ Internet Corporation for Assigned という組織がアドレスを決定し、地域ごとの NIC （ Network Information Center ）と 呼ばれる民間の非営利機関によって管理されている。 プライベート IP アドレス は、企業内など LAN の中で使える IP アドレスである。 LAN 内で重複がなければ、システム管理者が下の範囲内であれば自由に割り当てて使う ことができる。 クラス アドレス範囲 A 10.0.0.0 ～ 10.255.255.255 B 172.16.0.0 ～ 172.31.255.255 C 192.168.0.0 ～ 192.168.255.255 会社内の人に渡したい文書 があるときには、わざわざポストに投函して郵送せずに、直接渡せばよい。 上記のようにアドレス範囲が決まっていることで、送られてきたパケットの宛先が同じ LAN 内なら、わざわざその LAN の外にパケットを出さないという仕組みが実現されて ","11.3 一斉送信 13 いる。 127.0.0.1 という IP アドレスは、 ループバックアドレス という特殊な IP アドレスであ り、このアドレスは自分自身を表している。 動作確認など、自分自身だけに関わる通信をしたいときに用いられる。 11.3 一斉送信 同一ネットワークの全てのホストに対して、一斉に同じデータを送信すること を ブロードキャスト という。 これを行うには、宛先としてホストアドレスが全て 1 となる IP アドレスを指定する。 ブロードキャストはネットワーク内の全員宛てであるため、第 3 層の機器（ ルータ ）を 越えてパケットが流れることはないが、第 2 層以下の機器は、このパケットを受信すると 全ての ポート へと転送する。 ブロードキャストの対義語として、特定の 1 台のみに送信することを ユニキャスト と いう。 複数ではあるが不特定多数ではなく、決められた範囲内の複数ホストに送信すること を マルチキャスト という。 この用途に割り当てられている IP アドレスはクラス D に該当し、先頭 4 ビット が 1110 で、特定のグループに一斉送信することから、その中の機器を特定する必要 がないため、ホストアドレスはない。ネットワークアドレスの部分で目的のグループを指 定する。 11.4 ネットワーク分割 IP アドレスのどこからどこまでをネットワークアドレスとみなすかを指定するビット列 を サブネットマスク という。 これは、1 と 0 からなる 32 桁のビット列であり、 ","11.4 ネットワーク分割 14 • ネットワークアドレス部とみなしたいビットは 1 • ホストアドレス部とみなしたいビットは 0 とする。 例えば、クラス C（ネットワークアドレス部が 24 ビット）の IP アドレスで、 11111111111111111111111111 | {z } 26 ビット 000000 | {z } 6 ビット というサブネットマスクを指定した場合を考えると、 ネットワークアドレス部は、サブネットマスク指定によって 2 ビット長くなる。 長くなったネットワークアドレス部の末尾 2 ビットを サブネット といい、 この部分が • 00 であるネットワーク • 01 であるネットワーク • 10 であるネットワーク • 11 であるネットワーク というように、4 つのネットワークに分割することができる。 IP アドレスが「192.168.1.1」、サブネットマスクが「255.255.255.0」である場合のサブ ネットワークアドレスを考える。 255 は 2 進数に直すと 11111111 であるから、「192.168.1」の部分をネットワークアドレ ス部とみなしたい、ということになる。 ネットワークアドレスのホストアドレス部はすべて 0 となるから、先ほど求めたネット ワークアドレス部と合体させると、 「192.168.1.0」が求めるサブネットワークアドレスとなる。 IP アドレス サブネットマスク ネットワークアドレス 0 0 0 0 1 0 1 0 0 1 1 1 ","11.5 ルーティングとルータ 15 サブネットマスクが 1 の部分の情報は残し、0 の部分の情報は切り捨てる（もれなく 0 と する）ということから、 IP アドレスとサブネットマスクの AND 演算を行って求めると考 えてもよい。 11.5 ルーティングとルータ インターネット上には無数の端末が存在するため、無闇にパケットを中継して目的の端末 を探すのは効率が悪すぎる。 そこで、 ルーティング （経路制御）という、異なるサブネットワークにパケットを送る ときに、どこを中継させるのが効率的なのかを教える仕組みが生み出された。 「どこに中継させればよいか」という情報をまとめた表（テーブル）を ルーティングテーブル と いう。 各ネットワーク間を中継させる端末を ルータ といい、2 つ以上の端末を接続する目的で 使用される。 この機器によって LAN 同士が接続され、インターネットが構築されている。 ルータではないコンピュータのことは ホスト と呼ばれる。 また、ルータとそうでないコンピュータを区別せず、ネットワークに繋がったコンピュー タの総称を ノード という。 ルーティングテーブルは、大きく分けて • スタティックルーティング • ダイナミックルーティング の 2 種類の方法で作られている。 前者は小規模の LAN などで管理者がどのようにパケットを配送すればよいかを把握して いる場合に手動で登録する方法で、ネットワーク構成に変更があった場合も手動で登録し 直さなければならない。 後者は主にルータで用いられている方法で、ルーティング情報を隣り合ったルータ同士で 交換し、ルーティングテーブルを更新する。自動で行われるが、ネットワーク内にルー ティング情報の通信が流れ、 トラフィック （ネットワークの通信量）が増加するという ","11.6 IP アドレスと MAC アドレスの変換 16 欠点もある。 11.6 IP アドレスと MAC アドレスの変換 MAC アドレスが個人名（マイナンバー）で、IP アドレスは住所である。 IP アドレスだけがわかっていても、MAC アドレスがわからなければ本人に届けることは できない。 各端末は自分の MAC アドレスは知っているが、送り先の端末の MAC アドレスは知らな いため、IP アドレスから MAC アドレスを知る方法が必要になる。 このとき用いられるプロトコルが ARP （ Address Resolution Protocol ）であり、 このプロトコルでは、 ARP 要求パケット を ブロードキャスト して、目的の端末か ら 応答パケット として MAC アドレスを取得する。 LAN 内にパケットが届く度に ARP 要求を出すのではトラフィックの増加が起こるため、 一度 IP アドレスと MAC アドレスが関連付けられると、それをメモリに蓄えていく仕組 みになっている。 この 2 つのアドレスの対応表を ARP テーブル といい、IP アドレスがこのテーブルに登 録されていないときにだけ、ARP 要求を出すようになっている。 逆に、MAC アドレスから IP アドレスを取得するために用いるプロトコルは RARP （ Reverse Address Resolution Protocol ）であり、このプロトコルでは、自身の MAC ア ドレスを RARP 要求フレーム にセットして流し、 RARP サーバ から応答を受け取る。 11.7 IP というプロトコル 11.8 IP ヘッダ IP によって運ばれるパケットの一つ一つには、差出人と宛先の IP アドレスが載ってい る。 ","11.8 IP ヘッダ 17 具体的には、これらは ヘッダ （例えるなら送状伝票）に記載されている。 IP ヘッダは、次のような構造になっている。 バージョン （4bit） ヘッダ長 （4bit） サービス タイプ （8bit） 全データ長 （16bit） 識別子 （16bit） フラグ （3bit） フラグメント オフセット （16bit） 生存時間 （8bit） プロトコル （8bit） ヘッダチェックサム （16bit） 発信元 IP アドレス （32bit） 宛先 IP アドレス （32bit） データ バージョンには、現行プロトコルのバージョンが入る。 ","11.9 ネットワーク検査 18 11.9 ネットワーク検査 TCP/IP のパケット転送において、発生した各種エラー情報を報告するために用いられる プロトコルが ICMP （ Internet Control Message Protocol ）である。 通信エラー発生時には、その発生場所からパケットの送信元に対して、このプロトコルに よってエラー情報が通知されることにより、発生した障害内容を知ることができる。 Type 意味 説明 0 エコー応答 エコー要求に対する応答 3 宛先到達可能 パケットが届けられない理由を通知 4 送出抑制要求 受信能力の超過によりパケットが破棄された旨を通知 5 リダイレクト 最適な経路選択のために適切なゲートウェイを通知 8 エコー要求 エコー要求を指定ホストに対して行う 11 時間切れ パケットが生存時間超過により破棄されたことを通知 ping は、ICMP の • エコー要求 （ echo request ） • エコー応答 （ echo reply ） を利用して指定コンピュータまでパケットが届くかを試すことで、ネットワークの疎通が 確認できるコマンドである。 このコマンドによって生じる通信は、一般に Ping （ ピン ）と呼ばれ、 このコマンドを使用することを Ping を打つ などと表現することも多い。 traceroute は、 • パケットの 生存期間 • 時間切れ メッセージ を利用することで、指定コンピュータに到達するまでの間にどのような経路（ルータ）を 辿っているか調査できるコマンドである。 パケットが通るルータの台数は、インターネットにおける論理的な距離のようなものとし ","11.10 パケットの分割送信 19 て扱われ、これを ホップ数 という。 11.10 パケットの分割送信 11.11 仮 TCP/IP ネットワークにおける ネットワーク 層の IP （ Internet Protocol ）は、 経路制御を行い、ネットワークからネットワークへとパケットを運んで相手に送り届ける という、網としての経路機能を担う。 事前に相手と接続確認をとることなく一方的にパケットを送りつける コネクションレス 型の通信であるため、通信品質の保証については 上 位層に任せる。 12 トランスポート層 TCP/IP ネットワークにおける トランスポート 層の TCP （ Trabsmission Control Protocol ）は、 3 ウェイハンドシェイク という手順によって通信相手とコネクションを確立し、データ を送受信する コネクション 型の通信プロトコルである。 • パケットの順序 • 送信エラー時の再送 などを制御して、送受信するデータの 信頼 性を保証する。 TCP/IP ネットワークにおける トランスポート 層の UDP （ User Datagram Protocol ） は、データの信頼性よりも リアルタイム 性を重視して、パケットの再送制御などを一切 行わない コネクションレス 型の通信プロトコルである。 ","12.1 仮 20 12.1 仮 12.1.1 グローバル IP アドレスとプライベート IP アドレスの変換 プライベート IP アドレスしか持たない LAN 内コンピュータが外のコンピュータとやり とりするための技術として、 • NAT • NAPT （ IP マスカレード ） といったアドレス変換技術がある。これらは、 ルータ などによく実装されている。 NAT では、グローバル IP アドレスとプライベート IP アドレスを 1 対 1 で結びつけて、 相互に変換を行う。 1. LAN 内コンピュータから外部コンピュータ宛のパケットが流れてくると、 送信元 IP アドレスを自分の管理するグローバル IP アドレスに書き換えてから LAN 外へ流す 2. 外部コンピュータから返信されてきたパケットを受け取ると、 宛先を元々の送信元 IP アドレスに書き換えてから LAN 内に流す プライベート IP アドレスとグローバル IP アドレスの対応関係を維持するため、 同時にインターネット接続できるのは、 グローバル IP アドレスの個数分 だけとなる。 IP マスカレードでは、グローバル IP アドレスに複数の IP アドレスを結びつけて、1 対 複数 の変換を行う。 • LAN 内コンピュータから外部コンピュータ宛のパケットが流れてくると、 送信元 IP アドレスを自分の管理するグローバル IP アドレスに書き換えると同時 に、 ポート番号 も書き換えて、それと各コンピュータとの対応を記憶する • 外部コンピュータから返信されてきたパケットを受け取ると、 着信した ポート番号 により元々の IP アドレスを割り出して、 その値に書き換えてから LAN 内に流す ","21 というようにすることで、1 つの グローバル IP アドレス でも複数のコンピュータが同時 にインターネット接続することができる。 13 アプリケーション層 13.1 IP アドレスの別名 覚えづらい IP アドレスに対して、文字で別名をつけたものを ドメイン名 という。 たとえば、 www.tetracalibers.co.jp というドメイン名の各部分は、 • www ··· コンピュータの名前 • tetracalibers ··· 組織の名前 • co ··· 組織の種類 （co なら 企業 ） • jp ··· 国の名前 （jp なら 日本 ） という意味になっている。 ドメイン名と IP アドレスを関連づけして管理しているのが DNS （ Domain Name System ）である。 13.2 ネットワークの設定 DHCP （ Dynamic Host Configuration Protocol ）というプロトコルを利用すると、 IP アドレスの割り当てなどといったネットワークの設定作業を自動化することができる。 新しく LAN に参加したいコンピュータから、LAN 上の DHCP サーバ にリクエストを飛 ばすと、使われていない IP アドレスとそのネットワークで用いる各種設定内容が提供さ れ、その内容で LAN に参加することができる。 ","13.3 ネットワークの管理 22 13.3 ネットワークの管理 ネットワーク構成機器の状態や設定を管理するために用いられるプロトコルが SNMP （ Simple Network Management Protocol ）であり、 • 監視用サーバを SNMP マネージャ • 監視対象機器を SNMP エージェント という。 SNMP エージェントは、 MIB （ Management Information Base ）と呼ばれる一種の データベースを持っており、ここに管理すべき • 設定情報 • トラフィックの状態 • 故障情報 などが蓄積されている。 マネージャとエージェント間では、 PDU （ Protocol Data Unit ）というコマンドによ り情報のやりとりを行う。 マネージャからは、 • Get-Request （MIB 情報の取得リクエスト） • Get-Next-Request （次の MIB 情報の取得リクエスト） • Set-Request （MIB 情報の設定リクエスト） などの PDU を発行して、エージェントのもつ MIB 情報の取得や設定変更を行う。 エージェントからは、その都度 • Get-Response （リクエストに対する応答） が返ってくる。 機器に故障が発生したり、予め設定しておいた閾値を超える何かしらのイベントが発生し ","13.4 代表的なサービス 23 た場合には、エージェント側からマネージャへと • Trap （エージェントからマネージャへの自律的な情報通知） という PDU が発行され、異常の発生を通知する。 要求に応じて何らかの処理を提供する機能を サービス という。 TCP/IP を基盤とするネットワークではさまざまなサービスが多数利用できるようになっ ており、それらのサービスは、TCP/IP のさらに上位層（ セッション 層以上）で規定され ているプロトコル群によって支えられている。 13.4 代表的なサービス HTTP （ HyperText Transfer Protocol ）は、Web ページの転送に利用するプロトコル であり、 • Web ブラウザを使って HTML で記述された文書を受信する時 などに用いられる。 FTP （ File Transfer Protocol ）は、ファイル転送サービスに利用するプロトコルで あり、 • インターネット上のサーバにファイルをアップロードする時 • インターネット上のサーバからファイルをダウンロードする時 などに用いられる。 Telnet は、他のコンピュータにログインして、遠隔操作を行う際に用いるプロトコルで ある。 SMTP （ Simple Mail Transfer Protocol ）は、電子メールの配送部分を担当するプロ トコルであり、 ","13.5 サービスの識別 24 • メール送信時 • メールサーバ間での送受信時 などに用いられる。 POP （ Post Oﬃce Protocol ）は、電子メールの受信部分を担当するプロトコルであり、 • メールサーバ上にあるメールボックスから、受信したメールを取り出す時 に用いられる。 現在は POP3 が広く使われている。 IMAP （ Internet Message Access Protocol ）は、電子メールの受信部分を担当するプ ロトコルであるが、POP とは異なり、送受信データを送受信データをサーバー上で管理 するため、どのコンピュータからも同じデータを参照することができる。 NTP （ Network Time Protocol ）は、コンピュータの時刻合わせを行うプロトコルで ある。 13.5 サービスの識別 一つのコンピュータが様々なサーバを兼任することは少なくないが、 IP アドレスでは、パ ケットの宛先となるコンピュータを識別するだけで、それがそのコンピュータのどのサー バプログラムに宛てたものなのかを特定することはできない。 そこで、プログラムの側では 0 ～ 65535 までの範囲で自分専用の接続口ウィ設けて待つ ようになっており、この接続口を示す番号のことを ポート番号 という。 代表的なサービスには、予め次のようにデフォルトのポート番号が定められている。 ","13.5 サービスの識別 25 サービス ポート番号 HTTP サーバ 80 FTP サーバ 制御用 80 転送用 20 Telnet サーバ 23 SMTP サーバ 25 POP サーバ 110 NTP サーバ 123 自宅からインターネットに接続する場合、ほとんどの人が インターネットプロバイダ （ ISP ）と呼ばれる接続事業者を利用することになる。 WWW （ World Wide Web ）は、 Web ブラウザ を使って、世界中に散在する Web サーバ から文字や画像、音声などの 様々な情報を得ることができるサービスである。 ドキュメント間に リンク が張り巡らされて網の目状となっている構造を蜘蛛の巣 （ Web ）に例えたことがサービス名の由来である。 Web 上で取得したいファイルの場所を指し示すには、 URL （ Uniform Resource Locator ）という表記方法を用いる。 例えば、 http://www.tetracalibers.co.jp/book/index.html という URL の各部分は、 • http ··· プロトコル • www.tetracalibers.co.jp ··· ドメイン名 • book ··· ディレクトリ名 • index.html ··· ファイル名 と呼ばれ、URL 全体としては、 1. HTTP という プロトコル を使って ","13.6 電子メールの仕組み 26 2. tetracalibers.co.jp という ネットワーク の 3. www という サーバ が公開している 4. /book ディレクトリ の下の 5. index.html という ファイル を指定する、という意味になる。 Web ブラウザからの要求に応じて、Web サーバ側で外部ブログラムを実行するために用 いる仕組みに、 CGI （ Common Gateway Interface ）がある。 CGI プログラムを示す URL が要求されると、Web サーバは外部のプログラムを実行し て、その処理結果を返す。 これにより、 インタラクティブ （対話的）なページを作ることができる。 13.6 電子メールの仕組み 電子メールを実際にやりとりするには、電子メールソフト（ メーラー ）と呼ばれる専用 のアプリケーションを使用する。 電子メールのやりとりには メールアドレス という、住所＋名前に相当するものが使わ れる。 例えば、 tomixy@tetracalibers.co.jp というメールアドレスの各部分は、 • @より左（tomixy）··· ユーザ名 （名前に相当） • @より右（tetracalibers.co.jp）··· ドメイン名 （住所に相当） と呼ばれる。 ","13.7 電子メールの宛先 27 13.7 電子メールの宛先 TO は本来の意味の「宛先」であり、送信したい相手のメールアドレスを記載する。 CC （ Carbon Copy ）には、一応参考までにコピーを送っておきたい相手のメールアド レスを記載する。 BCC （ Blind Carbon Copy ）には、こっそり渡しておきたい相手のメールアドレスを 記載する。 同じメールを複数の相手に送るやり方を 同報メール といい、 , で区切ることで、TO・ CC・BCC 欄に複数のメールアドレスを指定することができる。 13.8 電子メールで扱うデータ形式 電子メールでは、本来 ASCII 文字しか扱うことができないが、 • 日本語などの 2 バイト 文字 • 画像などのファイル などを base64 などの方式で文字列に変換して受送信できるようにする拡張規格 が MIME （ Multipurpose Internet Mail Extensions ）である。 MIME に暗号化や電子署名の機能を加えた規格として、 S/MIME がある。 14 リンク層 この層の役割は実際の物理的な製品や企業と近いところに位置しているため、策定にはさ まざまな機能や団体が関わってくる。 その中でも、特に IEEE （ The Institute of Electrical and Electronic Engineers, Inc. ） という団体が標準化の主体となっている。 ","14.1 仮 28 14.1 仮 NIC （ Network Interface Card ）は、コンピュータをネットワークに接続するための拡 張カードであり、 LAN ボード とも呼ばれる。 データを電気信号に変換してケーブルに流したり、受け取ったりする役割を担い、コン ピュータをネットワークに繋ぐ段階である 物理層 で活躍する。 NIC をはじめとするネットワーク機器には、製造段階で MAC アドレス という番号が割 り振られている。 この番号は、 24 ビットずつの • IEEE によって管理される 製造メーカ番号 • 自社製品に割り振る 製造番号 を繋げてできており、世界中で重複しない一意の番号であることが保証されている。 LAN の規格では、方式ごとにケーブルの総延長距離が定められており、それ以上の距離 で通信しようとすると、信号が歪んでしまってまともに通信できない。 リピータ を間に挟むと、この信号を整形して再送出してくれるため、信号の歪みを解消 することができる。 ここで登場した リピータ も LAN ケーブル も、コンピュータをネットワークに繋ぐ段階 である 物理層 に位置する装置である。 ネットワークに流したパケットは、とりあえず全員に送り、受け取った側に必要 or 不要 の判断を任せているが、この無条件にデータが流される範囲（1 本のケーブルで繋がって いる範囲）を セグメント という。 リピータはパケットの中身を解釈することはできないため、不要なパケットも全て中継し てしまう。 そのため、一つのセグメント内に大量のコンピュータが繋がれていると、パケットの衝突 ","14.1 仮 29 （ コリジョン ）が多発するようになり、回線の 利用効率 が下がる。 ブリッジ は、同一ネットワーク内のセグメント間の中継役として、流れてきたパケット の MAC アドレス情報を確認し、必要であれば他方のセグメントへとパケットを流す役割 を担う。 同一ネットワーク内での通信を行うため、 データリンク 層に位置する装置である。 ブリッジは、流れてきたパケットを監視することで、最初にそれぞれのセグメントに属す る機器の MAC アドレス を記憶してしまう。 以降はその一覧に従って、セグメント間を橋渡しする必要のあるパケットだけ中継を行 う。 中継パケットは CSMA/CD 方式に従って送出するため、 コリジョン の発生が抑制され て、ネットワークの 利用効率 向上に役立つ。 ハブ は、LAN ケーブルの接続口（ ポート ）を複数持つ集線装置であり、 • 内部的にリピータを複数束ねたものである リピータハブ • ブリッジを複数束ねたものである スイッチングハブ の 2 種類がある。 リピータ ハブは、流れてきたパケットを無条件に全てのポートへと送出する。 スイッチング ハブは、流れてきたパケットを宛先 MAC アドレス に該当するコンピュー タが繋がっているポートにだけ送出する。 「どのネットワークに属する何番のコンピュータか」という内容を示す情報 を IP アドレス という。 ブリッジが行う転送はあくまでも MAC アドレスが確認できる範囲でのみ有効であるた め、外のネットワーク宛のパケットを中継することはできない。 ","30 そこで、異なるネットワーク（ LAN ）間の中継役である ルータ が必要となる。 ルータは、パケットに書かれた宛先 IP アドレス を確認し、これと自身がもつ 経路表 （ ルーティングテーブル ）を付き合わせて、最適な転送先（隣接する mm ルータのうち、 宛先に最も近そうなもの）を選択する。 このことを 経路選択 （ ルーティング ）という。 ゲートウェイ は、プロトコルの差異を変換・吸収することで、 トランスポート 層以上が 異なるネットワーク間での接続を可能にする装置である。 15 TCP/IP の進化 第 III 部 ネットワークの伝送速度 ネットワークの伝送に要する時間は、次式によって求めることができる。 伝送時間 [s] = データ量 [Mbit] 回線速度 [Mbit/s] 伝送速度に用いられる bps （ Bits Per Second ）という単位は、1 秒間に送ることので きるデータ量（ビット数）を表している。 一般的な使用法で実際に出る速度のことを 実効速度 という。 伝送効率 は、理論値に対して実際に出る速度の割合を表す。 ","31 第 IV 部 データの誤り制御 二つの装置間で通信を行う時、通信時の回線状況や機器同士のやりとりなど、様々な原因 で通信データの送信誤りが起こる。 • 1 ビット誤り検出には パリティ （ 奇数パリティ と 偶数パリティ ） • 1 ビット誤り訂正＋ 1 ビット誤り検出には 垂直パリティ と 水平パリティ • 1 ビット誤り訂正＋ 2 ビット誤り検出には ハミング符号 • n ビット誤り検出には CRC を用いる。 パリティ とは、ある数字の並びの合計が偶数か奇数かによって通信の誤りを検出する技 術である。 パリティでは、データの最後に パリティビット を付加し、そのビットを基に誤りを検出 するが、1 の数が偶数になるように付加するやり方を 偶数パリティ 、奇数になるように 付加するやり方を 奇数パリティ という。 パリティは、使い方によっては誤り訂正を行うことができる。データが送られるごとに 最後に 1 ビットのパリティビットをつけるやり方を 垂直パリティ といい、最後にそれ ぞれのビットのデータを横断的に見て、全体で誤りがないかどうかをチェックするの に 水平パリティ を用いる。 垂直パリティと水平パリティを組み合わせることにより、どこかに 1 ビットの誤りが発生 した場合にその場所を特定でき、ビットを 反転 させることによってエラーを訂正できる。 ハミング符号 とは、データにいくつかに冗長ビットを付加することによって 1 ビットの 誤りを検出し、それを訂正できる仕組みである。 CRC （ Cyclic Redundancy Check ）は、連続する誤りを検出するための誤り制御の仕 ","32 組みである。送信する基となるデータをあらかじめ決められた多項式で除算し、その余り を CRC とする。送信側と受信側でそれぞれ除算を行い、余りが一致すれば誤りがないと 判断できる。（データは暗号化されておらず、多項式は公開されており改ざんして再計算 が可能なので、改ざん防止などのセキュリティチェックには使えない。） "]